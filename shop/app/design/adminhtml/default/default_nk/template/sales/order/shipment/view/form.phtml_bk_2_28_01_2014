<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     default_default
 * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>

<script type="text/javascript">
//10-12-2013 SOC	
function loadbox(id){
	//alert(id);
	jQuery("#loadercnf").css("display","block");
	
	form_key = '<?php echo Mage::getSingleton('core/session')->getFormKey() ?>';
	url1= '<?php echo Mage::helper("adminhtml")->getUrl("partialshipping/adminhtml_partialshipping/getconfirmbox"); ?>';
	
	jQuery.ajax({
		url:url1,
		data: { form_key: form_key, oId: id },  
		success:function(result){
			jQuery("#loadercnf").css("display","none");
			jQuery("#confirmbox").css("display","block");
			jQuery("#confirmbox1").html(result);
		
	}});
}	

function add_more(pid){
	
	//var ids=jQuery("#confirmincr").val();
	//ids++;
	jQuery("#confirmincr").val(ids);
	var str = '<tr id="row_'+pid+'"><td><input type="text" name="confirmbox[]" style="width : 80px"/></td><td><input type="text" name="confirmqty[]" style="width : 80px"/></td><td><input type="text" name="confirmlength[]" style="width : 80px"/></td><td><input type="text" name="confirmwidth[]" style="width : 80px"/></td><td><input type="text" name="confirmheight[]" style="width : 80px"/></td><td><input type="text" name="confirmweight[]" style="width : 80px"/></td><td><input type="text" name="confirmtitle[]" style="width : 80px"/> </td><td><span style="cursor:pointer;float: right;" title="Add More" class="addanother" onclick="remove_r('+pid+');">Remove</span></td></tr>';
	jQuery("#tabl_row_"+pid).append(str);				
	
}

function remove_r(id){
	jQuery("#row_"+id).remove();
	
}
//10-12-2013 EOC
//// 2-12-2013 SOC modified on 12-12-2013 S
function selMethod(){
	
	jQuery("#cnfrm").submit(function(e)
	{
	    var postData = jQuery(this).serializeArray();
	    var formURL = jQuery(this).attr("action");
	    document.getElementById('loading-mask').style.display = 'block';
	    //alert(formURL);
	    jQuery.ajax(
	    {
		url : formURL,
		type: "POST",
		data : postData,
		success:function(data, textStatus, jqXHR)
		{
		    //data: return data from server
		    //alert(data);
		    
		    //var n = data.indexOf("__");
		    
		    if(data ==  "numerror"){
			alert( "Please enter proper numeric value" );
		    }else if(data ==  "charerror"){
			alert( "Please enter text value for title" );
		    }else if( data ==  "qtyerror"){
			
			alert( "Total volume is larger than total quantity ordered" );
			
		    }else{
			//jQuery("#confirmres").val(data);
		    
		    ////////////////////////////////////////////////
		    
		var ec = document.getElementById("order_customshipping_method");
		var v = ec.options[ec.selectedIndex].value;
		
		var datasplit = data.split('####');
		var ret = datasplit[0];
		
		document.getElementById('boxstr').value = datasplit[1];
		
		document.getElementById('headconfrm').innerHTML = datasplit[2];
		document.getElementById('loading-mask').style.display = 'none';
		
		//var ret = data;
		//alert(v);
		if(v != ''){
		var vlu=v.split("__");
		var mth=vlu[0];
		var act='';
		if(mth=='australiapost' || mth=='vividadstnt' || mth=='vividadsint'){
		
		if(mth=='australiapost'){
			url= '<?php echo Mage::helper("adminhtml")->getUrl("partialshipping/adminhtml_partialshipping/getauspostmethod"); ?>';
			ret = datasplit[0];
			}
		
		else if(mth=='vividadstnt'){
			url= '<?php echo Mage::helper("adminhtml")->getUrl("partialshipping/adminhtml_partialshipping/gettntlocalmethod"); ?>';
			ret = datasplit[1];
			}
		else if(mth=='vividadsint'){
			url= '<?php echo Mage::helper("adminhtml")->getUrl("partialshipping/adminhtml_partialshipping/gettntintlmethod"); ?>';
			ret = datasplit[1];
			}
		
		//alert("auspost");
		var e = document.getElementById("order-customshipping_address_customer_address_id1");
		var strAddr = e.options[e.selectedIndex].value;
		
		var ordId=document.getElementById("orderIdP").value;
		
		var xmlhttp1;
		if (window.XMLHttpRequest)
		  {// code for IE7+, Firefox, Chrome, Opera, Safari
		  xmlhttp1=new XMLHttpRequest();
		  }
		else
		  {// code for IE6, IE5
		  xmlhttp1=new ActiveXObject("Microsoft.XMLHTTP");
		  }
		xmlhttp1.onreadystatechange=function()
		  {
		    
		  if (xmlhttp1.readyState==4 || xmlhttp1.status==200)
		    {
			if(xmlhttp1.responseText != '')
			{
			    //alert(xmlhttp.responseText);
			    
			    document.getElementById("metRet").style.display='block';
			    document.getElementById("semt").innerHTML= xmlhttp1.responseText;
			    
			}
		    }
		  }
		  form_key = '<?php echo Mage::getSingleton('core/session')->getFormKey() ?>';
		  //url= '<?php echo Mage::helper("adminhtml")->getUrl("partialshipping/adminhtml_partialshipping/getauspostmethod"); ?>';
		  
			//alert(url);
			if (strAddr!='') {
			      xmlhttp1.open("POST",url+"?addrsid="+strAddr+"&unit="+ret+"&ordId="+ordId+"&form_key="+form_key+"&isAjax=true",true);
			      xmlhttp1.send();
			}else{
			  alert("Select an address");
			}
		
			}else{
				document.getElementById("metRet").style.display='none';
				document.getElementById("selc_meth").value= v;
				
			}
			}else{
				
				alert("Select a shipping method");
			}
		    
		    
		    
		    
		    //////////////////////////////////////////////////////////
		    
		    }
		    
		    
		},
		error: function(jqXHR, textStatus, errorThrown)
		{
		    //if fails
		    alert("Fail");
		}
	    });
	    e.preventDefault(); //STOP default action
	});
	 
	jQuery("#cnfrm").submit();
	
	
}

//// 2-12-2013 EOC modified on 12-12-2013 E

///12-12-2013 SOC
//function urlMaker()
//{
//    //alert("dsfds");
//    document.getElementById("spnlblnumber").style.display='block';
//    var NumberValue = document.getElementById("labelnumber").value;
//    if ( isNaN(NumberValue) || NumberValue == "" || NumberValue == 0) 
//    {
//      alert('Please enter a numeric value to print label');
//    }
//    
//     //document.location.href = (document.getElementById("barurl").value + document.getElementById("labelnumber").value);
//     
// }

///3-2-1013 SOC modified 26-12-2013

// modified 14-01-2014
function urlMaker(url2)
{
     document.location.href = ( url2 + 1);
     
}
// modified 14-01-2014

function slmthd(str){
	
	//var strn=str.split("__");
	//var ret=strn[0]+" "+strn[1]+" "+strn[3]+"Day__"+strn[2];
	//Australiapost__STANDARD__6.95__2
	//alert(ret);
	document.getElementById("selc_meth").value=str;
	
}

function selMethod1(){
	var ec = document.getElementById("order_customshipping_method");
	var v = ec.options[ec.selectedIndex].value;
	
	var e = document.getElementById("order-customshipping_address_customer_address_id1");
	var strAddr = e.options[e.selectedIndex].value;
	var ordId = document.getElementById("orderIdP").value;
	document.getElementById("loadercnf").style.display='block'; ///17-1-2014
	if(v != ''){
	var vlu=v.split("__");
	if(vlu[0]=='australiapost'){
		var xmlhttp1;
		if (window.XMLHttpRequest)
		  {// code for IE7+, Firefox, Chrome, Opera, Safari
		  xmlhttp1=new XMLHttpRequest();
		  }
		else
		  {// code for IE6, IE5
		  xmlhttp1=new ActiveXObject("Microsoft.XMLHTTP");
		  }
		xmlhttp1.onreadystatechange=function()
		  { if (xmlhttp1.readyState==4 || xmlhttp1.status==200)
		    {
			if(xmlhttp1.responseText != '')
			{
			    //alert(xmlhttp.responseText);
			    document.getElementById("loadercnf").style.display='none'; ///17-1-2014
			    document.getElementById("metRet").style.display='block';
			    document.getElementById("semt").innerHTML= xmlhttp1.responseText;
			    
			}
		    }
		  }
		  form_key = '<?php echo Mage::getSingleton('core/session')->getFormKey() ?>';
		  url= '<?php echo Mage::helper("adminhtml")->getUrl("partialshipping/adminhtml_partialshipping/getauspostmethodol"); ?>';
		  if (strAddr!='') {
			xmlhttp1.open("POST",url+"?addrsid="+strAddr+"&ordId="+ordId+"&form_key="+form_key+"&isAjax=true",true);
			xmlhttp1.send();
		  }else{
		    alert("Select an address");
		  }
		
	}else if(vlu[0]=='vividadstnt'){
		
		//alert("sdfds");
		var xmlhttp1;
		if (window.XMLHttpRequest)
		  {// code for IE7+, Firefox, Chrome, Opera, Safari
		  xmlhttp1=new XMLHttpRequest();
		  }
		else
		  {// code for IE6, IE5
		  xmlhttp1=new ActiveXObject("Microsoft.XMLHTTP");
		  }
		xmlhttp1.onreadystatechange=function()
		  { if (xmlhttp1.readyState==4 || xmlhttp1.status==200)
		    {
			if(xmlhttp1.responseText != '')
			{
			    //alert(xmlhttp1.responseText);
			    document.getElementById("loadercnf").style.display='none'; ///17-1-2014
			    document.getElementById("metRet").style.display='block';
			    document.getElementById("semt").innerHTML= xmlhttp1.responseText;
			    
			}
		    }
		  }
		  form_key = '<?php echo Mage::getSingleton('core/session')->getFormKey() ?>';
		  url= '<?php echo Mage::helper("adminhtml")->getUrl("partialshipping/adminhtml_partialshipping/gettntlocal"); ?>';
		  if (strAddr!='') {
			xmlhttp1.open("POST",url+"?addrsid="+strAddr+"&ordId="+ordId+"&form_key="+form_key+"&isAjax=true",true);
			xmlhttp1.send();
		  }else{
		    alert("Select an address");
		  }
		
	}else if(vlu[0]=='vividadsint'){  ///26-12-2013
		
		//alert("sdfds");
		var xmlhttp1;
		if (window.XMLHttpRequest)
		  {// code for IE7+, Firefox, Chrome, Opera, Safari
		  xmlhttp1=new XMLHttpRequest();
		  }
		else
		  {// code for IE6, IE5
		  xmlhttp1=new ActiveXObject("Microsoft.XMLHTTP");
		  }
		xmlhttp1.onreadystatechange=function()
		  { if (xmlhttp1.readyState==4 || xmlhttp1.status==200)
		    {
			if(xmlhttp1.responseText != '')
			{
			    //alert(xmlhttp.responseText);
			    document.getElementById("loadercnf").style.display='none'; ///17-1-2014
			    document.getElementById("metRet").style.display='block';
			    document.getElementById("semt").innerHTML= xmlhttp1.responseText;
			    
			}
		    }
		  }
		  form_key = '<?php echo Mage::getSingleton('core/session')->getFormKey() ?>';
		  url= '<?php echo Mage::helper("adminhtml")->getUrl("partialshipping/adminhtml_partialshipping/gettntintl"); ?>';
		  if (strAddr!='') {
			xmlhttp1.open("POST",url+"?addrsid="+strAddr+"&ordId="+ordId+"&form_key="+form_key+"&isAjax=true",true);
			xmlhttp1.send();
		  }else{
		    alert("Select an address");
		  }
		
	}else{
		document.getElementById("selc_meth").value= v;
		
	}
	}else{
		
		alert("Select a shipping method");
	}
}
///12-12-2013 SOC

function closePopupForm1(id) {
	var e = document.getElementById(id);
	e.style.display = 'none';
}
</script>







<!--26-11-2013 SOC-->
<?php
	
	$partShipID=$this->getRequest()->getParam('shipment_id');
	$connectionRead = Mage::getSingleton('core/resource')->getConnection('core_read');
	$connectionWrite = Mage::getSingleton('core/resource')->getConnection('core_write');
	$tableName = Mage::getSingleton('core/resource')->getTableName('partialshipping_shipment_grid');
	$select = $connectionRead->select()->from($tableName, array('*'))->where('entity_id=?',$partShipID);
	$row = $connectionRead->fetchRow($select);
  
	$orderId=$row['order_id'];
	$_shipmenIncrtId=$row['increment_id'];
	$_order = Mage::getModel('sales/order')->load($orderId);
	
	
?>


<?php /* $_order = $this->getShipment()->getOrder() ?>
<?php  $_shipmentId = $this->getShipment()->getId() */ ?> <!--added 15-11-2013-->
<?php echo $this->getChildHtml('order_info') ?>

<?php

///18-11-2013 SOC
$roleId = implode('', Mage::getSingleton('admin/session')->getUser()->getRoles());
$roleName = Mage::getModel('admin/roles')->load($roleId)->getRoleName();

if($roleName == 'Administrators'){

///18-11-2013 EOC
?>


<!--********************** 16-11-2013 SOC Split this Shipment Starts Here By GC *********************-->

<div class="entry-edit">
        <div class="entry-edit-head">
            <h4 class="icon-head head-shipping-address"><?php echo Mage::helper('sales')->__('Split The Shipment') ?></h4>
        </div>
        <div style="alignment-adjust: central">
            <span style="alignment-adjust: central" class="shipentity">Entity : Order <?php echo $_order->getIncrementId();?></span>
	     <span>
		<?php
		
			$path = Mage::getBaseDir('media') . DS ."shiplabel" . DS .$_shipmenIncrtId.".pdf";
			$url2 = Mage::helper('adminhtml')->getUrl('partialshipping/adminhtml_partialshipping/download');
			if (file_exists($path)) {
				echo '<a href="'.str_replace('//s','/admin/s',$url2).'file/'.$_shipmenIncrtId.'.pdf/'.'">Download Pdf</a>';
			}
		?>
	    </span>
        <fieldset>
            
            
            <?php
                $customer_id = $_order->getCustomerId();
                $customer = Mage::getModel('customer/customer')->load($customer_id);
                $customerAddressCollection = Mage::getResourceModel('customer/address_collection')->addAttributeToFilter('parent_id',$customer_id)->getItems();
                $items= $_order->getAllItems();
                $urlp = Mage::helper("adminhtml")->getUrl("partialshipping/adminhtml_partialshipping/partshipform");
		
		$urln = Mage::helper("adminhtml")->getUrl("partialshipping/adminhtml_partialshipping/newformPost");
            ?>
	    
	    
	    
<form action="<?php echo $urlp ?>" method="post" name="partShipmnt" >
            <input type="hidden" name="orderIdP" id="orderIdP" value="<?php echo $orderId;?>" /> 
            <input type="hidden" name="shipmenIncrmnttId" value="<?php echo $_shipmenIncrtId;?>" />
	    <input type="hidden" name="shipmentId" value="<?php echo $partShipID;?>" />
            <input type="hidden" name="orderIncrementId" value="<?php echo $_order->getIncrementId();?>" />
            <input type="hidden" name="customerId" value="<?php echo $_order->getCustomerId();?>" />
	    
            
            <?php
            foreach($items as $itemId => $item){
                
            ?>
            <input type="hidden" name="itemId[]" value="<?php echo $item->getId(); ?>" />   
            <input type="hidden" name="proId[]" value="<?php echo $item->getProductId(); ?>" />
            <input type="hidden" name="proName[]" value="<?php echo $item->getName(); ?>" />
            <input type="hidden" name="proPrice[]" value="<?php echo $item->getPrice(); ?>" />
            <input type="hidden" name="proSku[]" value="<?php echo $item->getSku(); ?>" />
            <input type="hidden" name="proQty[]" value="<?php echo $item->getQtyOrdered(); ?>" />
            
            <?php
            }
            
            $OId = $_order->getId();
            $Finalurl = "zulfe/sales_shipment/view/shipment_id/".$partShipID;
            $Finalurl = str_replace('p//s','p/admin/s',$Finalurl);
            
            
            $items= $_order->getAllItems();
            $countItem=0;
	    $prd_id='';
            foreach($items as $itemId => $item){
                 
                $countItem +=$item->getQtyOrdered();
		
		///12-12-2013 SOC
		$prd_id .=$item->getProductId()."**";
		$connectionRead = Mage::getSingleton('core/resource')->getConnection('core_read');
		$tableName = Mage::getSingleton('core/resource')->getTableName('partialshipping_shipment_item');
		$select = $connectionRead->select()->from($tableName, array('*'))->where('order_item_id=?',$item->getId());
		$qty='';
		$row1 = $connectionRead->fetchAll($select);
		foreach($row1 as $r){
			$qty+=$r['qty'];
			
		}
		if( $qty < $item->getQtyOrdered() ){
			
			$toShip=$item->getQtyOrdered()-$qty;
		}else{
			$toShip=0;	
			
		}
		$toAllship=$toAllship+$toShip;
		///12-12-2013 EOC
            }
            $methods = Mage::getStoreConfig('carriers', Mage::app()->getStore()->getId());
	
		//print_r($methods);
	    $options = array();
	    foreach($methods as $_code => $carrierConfig)
	    {
	        if($carrierConfig['active']==1){
		    if(!$_title = Mage::getStoreConfig("carriers/$_code/title"))
			$_title = $_code;
                        $shippingTitle = Mage::getStoreConfig('carriers/'.$_code.'/title');
                        $shippingPrice = Mage::getStoreConfig('carriers/'.$_code.'/price');
                        $tPrice=number_format(($shippingPrice*$countItem),2);
                        //$val=$shippingTitle.'__'.$tPrice;
			$val=$_code.'__'.$tPrice;  /////2-12-2013
		    
//                    if($_code=='australiapost'){
//			
//			//echo "sgsgsgs";
//			$enableService=explode(",",$carrierConfig['auspost_enable_services']);
//		    }
    		    $options[] = array('value' => $val, 'label' => $_title . " ($_code)");
	        }
	    }
 
            
            ?>
            
            
            
            
            <!--Select Address starts here-->
            
            <div class="shipping-adr-custom1" id="show_address" style="display: block;">
		<!--16-1-2014 S-->
		<?php
			$_shippingAddress = $_order->getShippingAddress();
			$sName = $_shippingAddress->getFirstname().' '.$_shippingAddress->getLastname();
			$scountry_name=Mage::app()->getLocale()->getCountryTranslation($_shippingAddress->getCountry_id());
                        $sAdrInfo = $_shippingAddress->getStreetFull().', '.$_shippingAddress->getCity().', '.$scountry_name.', '.$_shippingAddress->getPostcode().', '.$_shippingAddress->getRegion();
		?>
		<!--16-1-2014 E-->
		
		
                   <span style="float: left"> Select Address : </span>
		   <select onchange="newaddress1('customer_form_content1');" name="sel_adr" id="order-customshipping_address_customer_address_id1">
			<option value="">Select</option>
			<option value="<?php echo $_shippingAddress->getId()."_S";?>"><?php echo $sName.', '.$sAdrInfo;?></option><!--16-1-2014 Added-->
                            
                        
                        <?php foreach($customerAddressCollection as $customerAddressCol){
                            $customer_address_id = $customerAddressCol->getData('entity_id');
                            $addressLoadId = Mage::getModel('customer/address')->load($customer_address_id);
                            $country_name=Mage::app()->getLocale()->getCountryTranslation($addressLoadId['country_id']);
                            $Name = $addressLoadId['firstname'].' '.$addressLoadId['lastname'];
                            $AdrInfo = $addressLoadId['street'].', '.$addressLoadId['city'].', '.$country_name.', '.$addressLoadId['postcode'].', '.$addressLoadId['region']; ?>
                            
                        <option value="<?php echo $customer_address_id;?>">
                            <?php echo $Name.', '.$AdrInfo;?>
                        </option>
                        <?php }?>
                        <option value="new">Add New Address</option>
                    </select>
                   <br/><br/>
                    <!--<br/><input type="button" id="selectAddress" value="Select" onclick="setAddress();" />-->
                    <div id="customer_form_content1"  class="form_details" style="display: none;">

                    <input type="hidden" name="oid" id="oid" value="<?php echo $OId?>" />
                    <input type="hidden" id="customerid" name="customerid" value="<?php echo $_order->getCustomerId()?>" />
                    <input name="form_key" type="hidden" value="<?php echo Mage::getSingleton('core/session')->getFormKey() ?>">
                    
                        <div class="content form">
                            
                            <div class="hor-scroll-form">
                                <table cellspacing="0" class="form-list">
                                    <tbody>
                                        <tr>
                                            <td class="label"><label for="order-shipping_address_firstname">First Name <span class="required">*</span></label>
                                            </td>
                                            <td class="value">
                                                <input type="text" class="input-text" value="" name="firstname" id="firstname">
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="label"><label for="order-shipping_address_lastname">Last Name <span class="required">*</span></label></td>
                                            <td class="value">
                                            <input type="text" class="input-text" value="" name="lastname" id="lastname">
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="label"><label for="order-shipping_address_company">Company</label></td>
                                            <td class="value">
                                                <input type="text" class=" input-text" value="" name="company" id="company">
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="label"><label for="order-shipping_address_street0">Street Address <span class="required">*</span></label></td>
                                            <td class="value">
                                            <div class="multi-input"><input type="text" class="input-text" value="" name="street" id="street">
                                            </div>
                                            </td>
                                        </tr>
                                    <tr>
                                        <td class="label"><label for="order-shipping_address_city">City <span class="required">*</span></label></td>
                                        <td class="value">
                                            <input type="text" class="input-text " value="" name="city" id="city">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="label"><label for="order-shipping_address_country_id">Country <span class="required">*</span></label></td>
                                        <td class="value">
						<!--16-1-2014 S-->
						<!--<select class="countries input-text select" name="country_id" id="country_id">
						    <option value=""> </option>
						    <option selected="selected" value="NZ">New Zealand</option>
						</select>-->
					    
					    
						<?php $_countries = Mage::getResourceModel('directory/country_collection')->loadByStore()->toOptionArray(); ?>
						<?php if (count($_countries) > 0): ?>
							<select name="country_id" id="country_id">
								<option value="">-- Please Select --</option>
								<?php foreach($_countries as $_country): ?>
									<option value="<?php echo $_country['value'] ?>">
										<?php echo $_country['label'] ?>
									</option>
								<?php endforeach; ?>
							</select>
						<?php endif; ?>
					    <!--16-1-2014 E-->
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="label">
                                            <label for="order-shipping_address_region">State/Province <span class="required" style="">*</span></label>
                                        </td>
                                        <td class="value"><input type="text" class="input-text" value="" name="region" id="region">
                                            <select style="display:none" class="select" name="region_id" id="order-shipping_address_region_id" defaultvalue="" disabled=""><option value="">Please select</option></select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="label"><label for="order-shipping_address_postcode">Zip/Postal Code <span class="required">*</span></label></td>
                                        <td class="value">
                                            <input type="text" class="input-text" value="" name="postcode" id="postcode">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="label"><label for="order-shipping_address_telephone">Telephone <span class="required">*</span></label></td>
                                        <td class="value">
                                            <input type="text" class="input-text" value="" name="telephone" id="telephone">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="label"><label for="order-shipping_address_fax">Fax</label></td>
                                        <td class="value">
                                            <input type="text" class=" input-text" value="" name="fax" id="fax">
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div id="submit_btn" class="form_submit">
                            <button type="button" onclick="saveAdr();" class="btn_cls">Save in Address Book</button>
                        </div>
			<a href="javascript:void(0);" class="cross-custom-form" onclick="closePopupForm1('customer_form_content1');">Close Window</a>
  
</div>
                
            
            </div>
            <!--Select Address ends here-->
            <br/>
            <!--Select shipping method starts-->
            <div class="shipping-adr-custom1" id="show_shipping_methods" style="display: block;">
             
	     
	     <!--////2-12-2013 SOC for auspost-->
	     <input type="hidden" name="sel_metd" value="" id="selc_meth" />  
	     
	     <!--////2-12-2013 EOC for auspost-->
	     
	     <span style="float: left"> Select Shipping Method : </span>
	     <select name="sel_metd1" id="order_customshipping_method" onchange="selMethod1();"> <!--////2-12-2013--> <!--onchange="selMethod();" removed 12-12-2013-->
	     <option value="">Select</option>
                 <?php
                    foreach($options as $val){ 
                 ?>
                    <option value="<?php echo $val["value"]; ?>">
                        <?php echo $val["label"];?>
                    </option>
                 <?php  } ?>
                
             </select>
	    <!--Select shipping method ends-->
	    <!--3-12-2013 SOC-->
	    
	    <div class="" id="metRet" style="display: none">
		<span>Select Method</span>
		<div id="semt"></div>
		
	    </div>
	    <!--3-12-2013 EOC-->
	     <br/><br/>
	     <span onclick="loadbox('<?php echo $OId ?>');" style="cursor:pointer;"><strong>Confirm Box</strong></span> <!--////17-1-2014-->
	      <!--10-12-2013 SOC  modified on 12-12-2013-->
	      <input type="hidden" name="confirmres" id="confirmres" value=""/>
	      <input type="hidden" name="confirmincr" id="confirmincr" value="1"/>
	      <input type="hidden" name="boxstr" id="boxstr" />
	      
	        <div  id="loadercnf" style="display: none;z-index: 100; position: absolute;background-color: #ffffff;top:800px;
                left:520px;width: 150px; border: 1px solid black;">
						<img src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_MEDIA); ?>ajax_loader.gif" height="50px" width="50px"/>
		</div>
	      
	      
	    <div class="confirmbox" id="confirmbox" style="display: none;z-index: 100; position: absolute;background-color: #ffffff;top:800px;
                left:220px;width: 850px; border: 1px solid black;">
		<div class="headconfrm" id="headconfrm" style="text-align: left;color:green;font-size: 14px;font-weight: bold;margin-left: 336px;">Please Confirm Boxes</div>
		<a href="javascript:void(0);" class="cross-custom-form" onclick="closePopupForm1('confirmbox');" style="float:right">Close Window</a>
		<br/>
		<div id="confirmbox1">
		</div>
	    </div>
	    
	    <!--10-12-2013 EOC-->
	    
            <br/><br/>
            <!--Items to Ship starts-->
            <div class="entry-edit">
            <div class="entry-edit-head">
            <h4 class="icon-head head-products"><?php echo $this->helper('sales')->__('Items To Shipped') ?></h4>
            </div>
            </div>
            <div class="grid np">
            <div class="hor-scroll">
              <table cellspacing="0" class="data order-tables">
                  <thead>
                      <tr class="headings">
                          <th><?php echo $this->helper('sales')->__('Product') ?></th>
			  <th class="a-center last"><span class="nobr"><?php echo $this->helper('sales')->__('Quantity Ordered') ?></span></th>
			  <th class="a-center last"><span class="nobr"><?php echo $this->helper('sales')->__('Ready To Shipped') ?></span></th>
			  <!--<th class="a-center last"><span class="nobr"><?php //echo $this->helper('sales')->__('Confirm Boxes') ?></span></th> --> <!--10-12-2013-->
                          <th class="a-center last"><span class="nobr"><?php echo $this->helper('sales')->__('Qty To Ship') ?></span></th>
			  
                      </tr>
                  </thead>
                  <?php $_items = $_order->getAllItems() ?>
		  
		  <!--5-12-2013 SOC-->
		  <?php
		  
		  $shipID=$this->getRequest()->getParam('shipment_id');
		  
		  $connectionRead = Mage::getSingleton('core/resource')->getConnection('core_read');
		  $table = Mage::getSingleton('core/resource')->getTableName('partialshipping_shipment_grid');
		  
		  $sel = $connectionRead->select()->from($table, array('*'))->where('entity_id=?',$shipID);
		  $r = $connectionRead->fetchRow($sel);
		  $shiIncrmnt=$r['increment_id'];
		  $ps = strpos($shiIncrmnt, '-');
		  
		  ?>
		  <!--5-12-2013 EOC-->
		  
                  <?php $toAllship=0; $_i=0; foreach($items as $itemId => $item){ $i++; ?>
		  
		   <?php
				$connectionRead = Mage::getSingleton('core/resource')->getConnection('core_read');
				$tableName = Mage::getSingleton('core/resource')->getTableName('partialshipping_shipment_item');
				$select = $connectionRead->select()->from($tableName, array('*'))->where('order_item_id=?',$item->getId());
				//echo "<br>";
				
				///6-12-2013 SOC
				$qty='';
				$row2 = $connectionRead->fetchAll($select);
				$qty_dec = 0;
				$title_dec = '';
				foreach($row2 as $r){
					$qty+=$r['qty'];
					
					/**************** Start for checking shipment status ***********************/
					$tableNameGrid = Mage::getSingleton('core/resource')->getTableName('partialshipping_shipment_grid');
					$select1 = $connectionRead->select()->from($tableNameGrid, array('*'))->where('entity_id=?',$r['parent_id']);
					
					$row3 = $connectionRead->fetchRow($select1);
					
					if($row3['status'] == 'shipmented')
					{
						$qty_dec += $r['qty'];
						$title_dec .= $row3['track_number'].',';
						
					}
					else{
						$title_dec .= $row3['track_number'].',';
					}
					
					/**************** End for checking shipment status ***********************/
					
				}
				
				/**************** Start for checking shipment status ***********************/
				if($qty_dec > 0)
				$qty_dec_str = '<span style="color:#01DF01;" title="'.trim($title_dec,',').'">( '.$qty.' )</span>';
				else
				$qty_dec_str = '<span title="'.trim($title_dec,',').'">'.$qty.'</span>';
				/**************** End for checking shipment status ***********************/
				
				//echo $qty;
				if( $qty < $item->getQtyOrdered() ){
					
					$toShip=$item->getQtyOrdered()-$qty;
				}else{
					$toShip=0;	
					
				}
				$toAllship=$toAllship+$toShip;
				
		if(strpos($_shipmenIncrtId,'-')){
		 
			if( $qty != ''){
			
			
			?>
                  
                      <tbody class="<?php echo $_i%2?'odd':'even' ?>">
                      <tr>
                        <td><?php echo $item->getName(); ?><br> SKU : <?php echo $item->getSku(); ?></td>
                       
		       <!--28-11-2013 SOC-->
		      
		       <td>
			
		        <!--15-1-2014 S-->
			
			
			<input type="hidden" name="qtyorderd[<?php echo $item->getId(); ?>][<?php echo $item->getProductId(); ?>]" value="<?php echo round($item->getQtyOrdered()) ?>" />
			<!--15-1-2014 E-->
			
		       <?php echo round($item->getQtyOrdered()) ?></td>
		       <td><?php if($qty)echo $qty_dec_str; else echo 0; ?></td>
		       
		       <!--<td><span onclick="loadbox(<?php //echo $item->getProductId()?>,<?php //echo $toShip?>);">Confirm Box</span></td>--> <!--10-12-2013-->
		
		       <td>
		
			<?php if($toShip > 0 && $ps == false) { ?>
			<input type="text" name="shipment[<?php echo $item->getId(); ?>][<?php echo $item->getProductId(); ?>]" value="<?php echo round($toShip); ?>" />
			<?php }else{ echo $toShip; } ?>
		       </td>
			
			<!--28-11-2013 EOC-->
                      </tr>
                          
                      </tbody>
                  <?php
			}
		 }
		 else{
			?>
			<tbody class="<?php echo $_i%2?'odd':'even' ?>">
                      <tr>
                        <td><?php echo $item->getName(); ?><br> SKU : <?php echo $item->getSku(); ?></td>
                       
		       <!--28-11-2013 SOC-->
		      
		       <td>
			
		        <!--15-1-2014 S-->
			
			
			<input type="hidden" name="qtyorderd[<?php echo $item->getId(); ?>][<?php echo $item->getProductId(); ?>]" value="<?php echo round($item->getQtyOrdered()) ?>" />
			<!--15-1-2014 E-->
			
		       <?php echo round($item->getQtyOrdered()) ?></td>
		       <td><?php if($qty)echo $qty_dec_str; else echo 0; ?></td>
		       
		       <!--<td><span onclick="loadbox(<?php //echo $item->getProductId()?>,<?php //echo $toShip?>);">Confirm Box</span></td>--> <!--10-12-2013-->
		
		       <td>
		
			<?php if($toShip > 0 && $ps == false) { ?>
			<input type="text" name="shipment[<?php echo $item->getId(); ?>][<?php echo $item->getProductId(); ?>]" value="<?php echo round($toShip); ?>" />
			<?php }else{ echo $toShip; } ?>
		       </td>
			
			<!--28-11-2013 EOC-->
                      </tr>
                          
                      </tbody>
		      <?php
		 }
		  
		  } ?>
              </table>
            </div>
           
            <!--Items to Ship ends-->
</div>
            
            
     
     </div><br/>
	    <?php if($toAllship >0 && $ps == false){?>
            <input type="submit" name="submit" value="Submit"/>
	    <?php } ?>
          </form>  
        </fieldset>
        </div>
</div>

<!--************************ 16-11-2013 EOC Split this Shipment Ends Here By GC *******************************-->
<!-- ////18-11-2013-->
<?php }

if($roleName == 'Warehouse' or in_array(42,Mage::getSingleton('core/session')->getAllpermission())){  ////6-12-2013 SOC
	
	
	$urlw = Mage::helper("adminhtml")->getUrl("partialshipping/adminhtml_partialshipping/warehouseform");
	
	?>
	
	<div class="box-left">
        <div class="entry-edit">
	<div class="entry-edit-head">
            <h4 class="icon-head head-shipping-address"><?php echo Mage::helper('sales')->__('Is Shipment Ready') ?></h4>
	   
        </div>
	<div class="grid np">
	
	<!--13-12-2013 modified on 17-12-2013 SOC-->
	 
	<?php //if($row['status']=='OK for shipping'){ ?>
	 <form action="<?php echo $urlw ?>" method="post" name="partShipmnt" style="alignment-adjust: central" >
	    <input name="form_key" type="hidden" value="<?php echo Mage::getSingleton('core/session')->getFormKey() ?>">
	    <input type="hidden" name="shipmentId" value="<?php echo $partShipID;?>" />
	    
		<div class="okfrship">
			<span><strong>Package status for shipping</strong></span><br/>
			<?php
			$path = Mage::getBaseDir('media') . DS ."shiplabel" . DS .$_shipmenIncrtId.".pdf";
			$url2 = Mage::helper('adminhtml')->getUrl('partialshipping/adminhtml_partialshipping/download');
			if (file_exists($path)) {
				//echo '<a href="'.str_replace('//s','/admin/s',$url2).'file/'.$_shipmenIncrtId.'-1.pdf/'.'">Download Pdf</a>';
			
		?>
	    
			<span><a href="<?php echo str_replace('//s','/admin/s',$url2).'file/'.$_shipmenIncrtId.'.pdf/';?>" >Print Label</a></span><br/>
		<?php
			}
			
			$permission_main = Mage::getSingleton('core/session')->getAllpermission();
		?>
			<span>Update Status :
			<select name="isready" <?php  if (!file_exists($path)) { ?> disabled="disabled" <?php } ?> >
			
				<option value="ntready">Not Ready</option>
				<option value="oktoship" <?php  if($row['status']=='OK For Shipping'){ ?> selected="selected" <?php } ?> >OK For Shipping</option>
				<option value="readytodespatch" <?php  if($row['status']=='Ready To Disptch'){ ?> selected="selected" <?php } ?> >Ready To Dispatched</option>
				<option value="picked" <?php  if($row['status']=='Picked Up'){ ?> selected="selected" <?php } ?>>Picked Up</option>
				<?php if(in_array(42,$permission_main)){?><option value="shipmented" <?php  if($row['status']=='Shipped'){ ?> selected="selected" <?php } ?>>Shipped</option><?php }?>
			</select>
			</span><br/>
		</div>
	    
	    <br/>
	    <?php  if (file_exists($path)) { ?><input type="submit" name="submit" value="Submit" /> <?php } ?>
	    </form>
	    <?php // }else { ?>
	    
	    <!--<span><strong>Shipment Is Not Ready Yet</strong></span><br/>-->
	    
	<?php //} ?>
	<!--13-12-2013 modified on 17-12-2013 EOC-->
	</div>
	</div>
	</div>
	<?php
	if($roleName == 'Warehouse'){
	?>
	<!--Items to Ship starts 28_01_2014-->
	<div class="box-right">
	<div class="entry-edit">
	<div class="entry-edit-head">	
	<h4 class="icon-head head-products"><?php echo $this->helper('sales')->__('Items To Shipped') ?></h4>
	
	</div>
	  <div class="grid np">
            <div class="hor-scroll">
              <table cellspacing="0" class="data order-tables">
                  <thead>
                      <tr class="headings">
                          <th><?php echo $this->helper('sales')->__('Product') ?></th>
			  <th class="a-center last"><span class="nobr"><?php echo $this->helper('sales')->__('Quantity Ordered') ?></span></th>
			  <th class="a-center last"><span class="nobr"><?php echo $this->helper('sales')->__('Ready To Shipped') ?></span></th>
			  <!--<th class="a-center last"><span class="nobr"><?php //echo $this->helper('sales')->__('Confirm Boxes') ?></span></th> --> <!--10-12-2013-->
                          <th class="a-center last"><span class="nobr"><?php echo $this->helper('sales')->__('Qty To Ship') ?></span></th>
			  
                      </tr>
                  </thead>
                  <?php
		  
		  $_items = $_order->getAllItems();
		  ?>
		 
		  <!--5-12-2013 SOC-->
		  <?php
		  
		 $shipID=$this->getRequest()->getParam('shipment_id');
		  
		  $connectionRead = Mage::getSingleton('core/resource')->getConnection('core_read');
		  $table = Mage::getSingleton('core/resource')->getTableName('partialshipping_shipment_grid');
		  
		  $sel = $connectionRead->select()->from($table, array('*'))->where('entity_id=?',$shipID);
		  $r = $connectionRead->fetchRow($sel);
		  $shiIncrmnt=$r['increment_id'];
		  $ps = strpos($shiIncrmnt, '-');
		  
		  ?>
		  <!--5-12-2013 EOC-->
		  
                  <?php $toAllship=0; $_i=0; foreach($_items as $itemId => $item){ $i++; ?>
		  
		   <?php
				$connectionRead = Mage::getSingleton('core/resource')->getConnection('core_read');
				$tableName = Mage::getSingleton('core/resource')->getTableName('partialshipping_shipment_item');
				$select = $connectionRead->select()->from($tableName, array('*'))->where('order_item_id=?',$item->getId());
				//echo "<br>";
				
				///6-12-2013 SOC
				$qty='';
				$row2 = $connectionRead->fetchAll($select);
				$qty_dec = 0;
				$title_dec = '';
				foreach($row2 as $r){
					$qty+=$r['qty'];
					
					/**************** Start for checking shipment status ***********************/
					$tableNameGrid = Mage::getSingleton('core/resource')->getTableName('partialshipping_shipment_grid');
					$select1 = $connectionRead->select()->from($tableNameGrid, array('*'))->where('entity_id=?',$r['parent_id']);
					
					$row3 = $connectionRead->fetchRow($select1);
					
					if($row3['status'] == 'shipmented')
					{
						$qty_dec += $r['qty'];
						$title_dec .= $row3['track_number'].',';
						
					}
					else{
						$title_dec .= $row3['track_number'].',';
					}
					
					/**************** End for checking shipment status ***********************/
					
				}
				
				/**************** Start for checking shipment status ***********************/
				if($qty_dec > 0)
				$qty_dec_str = '<span style="color:#01DF01;" title="'.trim($title_dec,',').'">( '.$qty.' )</span>';
				else
				$qty_dec_str = '<span title="'.trim($title_dec,',').'">'.$qty.'</span>';
				/**************** End for checking shipment status ***********************/
				
				//echo $qty;
				if( $qty < $item->getQtyOrdered() ){
					
					$toShip=$item->getQtyOrdered()-$qty;
				}else{
					$toShip=0;	
					
				}
				$toAllship=$toAllship+$toShip;
				
				
		if(strpos($_shipmenIncrtId,'-')){
		 
			if( $qty != ''){
			
			
			?>
                  
                      <tbody class="<?php echo $_i%2?'odd':'even' ?>">
                      <tr>
                        <td><?php echo $item->getName(); ?><br> SKU : <?php echo $item->getSku(); ?></td>
                       
		       <!--28-11-2013 SOC-->
		      
		       <td>
			
		        <!--15-1-2014 S-->
			
			
			<input type="hidden" name="qtyorderd[<?php echo $item->getId(); ?>][<?php echo $item->getProductId(); ?>]" value="<?php echo round($item->getQtyOrdered()) ?>" />
			<!--15-1-2014 E-->
			
		       <?php echo round($item->getQtyOrdered()) ?></td>
		       <td><?php if($qty)echo $qty_dec_str; else echo 0; ?></td>
		       
		       <!--<td><span onclick="loadbox(<?php //echo $item->getProductId()?>,<?php //echo $toShip?>);">Confirm Box</span></td>--> <!--10-12-2013-->
		
		       <td>
		
			<?php if($toShip > 0 && $ps == false) { ?>
			<input type="text" name="shipment[<?php echo $item->getId(); ?>][<?php echo $item->getProductId(); ?>]" value="<?php echo round($toShip); ?>" />
			<?php }else{ echo $toShip; } ?>
		       </td>
			
			<!--28-11-2013 EOC-->
                      </tr>
                          
                      </tbody>
                  <?php
			}
		 }
		 else{
			?>
			<tbody class="<?php echo $_i%2?'odd':'even' ?>">
                      <tr>
                        <td><?php echo $item->getName(); ?><br> SKU : <?php echo $item->getSku(); ?></td>
                       
		       <!--28-11-2013 SOC-->
		      
		       <td>
			
		        <!--15-1-2014 S-->
			
			
			<input type="hidden" name="qtyorderd[<?php echo $item->getId(); ?>][<?php echo $item->getProductId(); ?>]" value="<?php echo round($item->getQtyOrdered()) ?>" />
			<!--15-1-2014 E-->
			
		       <?php echo round($item->getQtyOrdered()) ?></td>
		       <td><?php if($qty)echo $qty_dec_str; else echo 0; ?></td>
		       
		       <!--<td><span onclick="loadbox(<?php //echo $item->getProductId()?>,<?php //echo $toShip?>);">Confirm Box</span></td>--> <!--10-12-2013-->
		
		       <td>
		
			<?php if($toShip > 0 && $ps == false) { ?>
			<input type="text" name="shipment[<?php echo $item->getId(); ?>][<?php echo $item->getProductId(); ?>]" value="<?php echo round($toShip); ?>" />
			<?php }else{ echo $toShip; } ?>
		       </td>
			
			<!--28-11-2013 EOC-->
                      </tr>
                          
                      </tbody>
		      <?php
		 }
		  
		  } ?>
              </table>
            </div>
	    </div>
	    </div>
	</div>
	
	
 <!--Items to Ship ends 28_01_2014-->
 <?php }?>
	<div class="clear"></div>
<?php	} ?> 




<div class="box-left">
    <!--Billing Address-->
    <div class="entry-edit">
        <div class="entry-edit-head">
            <h4 class="icon-head head-payment-method"><?php echo $this->helper('sales')->__('Payment Information') ?></h4>
        </div>
        <fieldset>
		<div>
			<?php echo 'Payment Status : '.$_order->getStatusLabel();?>
		</div>
            <div>
	    <!--5-12-2013 SOC-->
	    <?php
	    if($partShipID){
		$payment = $_order->getPayment();
		echo $_order->getPayment()->getMethodInstance()->getTitle();//$payment->getMethod();
	    }else{
		echo $this->getChildHtml('order_payment');
		
	    }
	    
	    ?>
	    <?php ///echo $this->getChildHtml('order_payment') ?>
	    
	    <!--5-12-2013 SOC-->
	    </div>
            <div><?php echo Mage::helper('sales')->__('Order was placed using %s', $_order->getOrderCurrencyCode()) ?></div>
        </fieldset>
    </div>
</div>
<div class="box-right">
    <!--Shipping Address-->
    <div class="entry-edit">
        <div class="entry-edit-head">
            <h4 class="icon-head head-shipping-method"><?php echo $this->helper('sales')->__('Shipping and Tracking Information') ?></h4>
        </div>
        <fieldset>
            <div>
                <?php if($this->getShipment()->getTracksCollection()->count()): ?>
                <a href="#" id="linkId" onclick="popWin('<?php echo $this->helper('shipping')->getTrackingPopupUrlBySalesModel($this->getShipment()) ?>','trackshipment','width=800,height=600,resizable=yes,scrollbars=yes')" title="<?php echo $this->__('Track this shipment') ?>"><?php echo $this->__('Track this shipment') ?></a>
                <br/>
                <?php endif; ?>
                <strong><?php echo $this->escapeHtml($_order->getShippingDescription()) ?></strong>
                <?php echo $this->helper('sales')->__('Total Shipping Charges'); ?>:

                <?php if ($this->helper('tax')->displayShippingPriceIncludingTax()): ?>
                    <?php $_excl = $this->displayShippingPriceInclTax($_order); ?>
                <?php else: ?>
                    <?php $_excl = $this->displayPriceAttribute('shipping_amount', false, ' '); ?>
                <?php endif; ?>
                <?php $_incl = $this->displayShippingPriceInclTax($_order); ?>

                <?php echo $_excl; ?>
                <?php if ($this->helper('tax')->displayShippingBothPrices() && $_incl != $_excl): ?>
                    (<?php echo $this->__('Incl. Tax'); ?> <?php echo $_incl; ?>)
                <?php endif; ?>
            </div>
            <?php if ($this->canCreateShippingLabel()): ?>
            <div style="text-align: center; margin: 10px 0;">
                <?php echo $this->getCreateLabelButton()?>
                <?php if ($this->getShipment()->getShippingLabel()): ?>
                    <?php echo $this->getPrintLabelButton() ?>
                <?php endif ?>
                <?php if ($this->getShipment()->getPackages()): ?>
                    <?php echo $this->getShowPackagesButton() ?>
                <?php endif ?>
            </div>
            <?php endif ?>
            <div><?php echo $this->getChildHtml('shipment_tracking') ?></div>
        </fieldset>
    <?php //echo $this->getChildHtml('shipment_packaging') ?>
    <script type="text/javascript">
    //<![CDATA[
    <?php /*?>
        document.observe("dom:loaded", function() {
            setTimeout(function(){
                packaging.setConfirmPackagingCallback(function(){
                    packaging.sendCreateLabelRequest();
                });
                packaging.setLabelCreatedCallback(function(response){
                    setLocation("<?php echo $this->getUrl(
                        'sales_order_shipment/view',
                      array('shipment_id' => $this->getShipment()->getId())
                    ); ?>");
                });
            }, 500);
        });
    //]]>
    
    <?php */?>



function saveAdr(){
//alert("xcvxc");
var FinalUrl = '<?php echo $Finalurl?>';
var customerid = document.getElementById('customerid').value;
var ordid = document.getElementById('oid').value;
var firstname = document.getElementById('firstname').value;
var lastname = document.getElementById('lastname').value;
var company = document.getElementById('company').value;
var street = document.getElementById('street').value;
var city = document.getElementById('city').value;
var country_id = document.getElementById('country_id').value;
var region = document.getElementById('region').value;
var postcode = document.getElementById('postcode').value;
var telephone = document.getElementById('telephone').value;

var xmlhttp;
if (window.XMLHttpRequest)
  {// code for IE7+, Firefox, Chrome, Opera, Safari
  xmlhttp=new XMLHttpRequest();
  }
else
  {// code for IE6, IE5
  xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
  }
xmlhttp.onreadystatechange=function()
  {
    
  if (xmlhttp.readyState==4 || xmlhttp.status==200)
    {
	
	//document.getElementById("sc_cal_out").innerHTML=xmlhttp.responseText;
	//alert(xmlhttp.responseText);
	
	//document.getElementById('todobody').innerHTML = xmlhttp.responseText;
	
	if(xmlhttp.responseText != '')
	{
	    alert(xmlhttp.responseText);
	    
	}
	else{
	    if (firstname!='' && lastname!='' && street!='' && city!='' && country_id!='' && region!='' && postcode!='' && telephone!='') {
		window.location = FinalUrl;
	    }
	    //alert('There are some problem to delete.');
	}
      
    }
  }
  form_key = '<?php echo Mage::getSingleton('core/session')->getFormKey() ?>';
  if (firstname!='' && lastname!='' && street!='' && city!='' && country_id!='' && region!='' && postcode!='' && telephone!='') {
xmlhttp.open("POST","<?php echo $urln ?>?customerid="+customerid+"&oid="+ordid+"&firstname="+firstname+"&lastname="+lastname+"&company="+company+"&street="+street+"&city="+city+"&country_id="+country_id+"&region="+region+"&postcode="+postcode+"&telephone="+telephone+"&form_key="+form_key+"&isAjax=true",true);
xmlhttp.send();
  }else{
    alert("Fill up all fields");
  }

}


//<!--16-11-2013 SOC-->
function newaddress1(id) {

var SelId = document.getElementById(id);
var FormId = document.getElementById("order-customshipping_address_customer_address_id1");
var selectedValue = FormId.options[FormId.selectedIndex].value;
if (selectedValue == 'new') {
    
    if(SelId.style.display == 'block')
	SelId.style.display = 'none';
    else
	SelId.style.display = 'block';
	   
}
else{
     SelId.style.display = 'none';
}
}
//<!--16-11-2013 EOC-->
    </script>
    </div>
</div>
<div class="clear"></div>
<div style="display: none"> <!--28-11-2013-->
    <div class="entry-edit">
        <div class="entry-edit-head">
        <h4 class="icon-head head-products"><?php echo $this->helper('sales')->__('Items Shipped') ?></h4>
        </div>
    </div>
 
<?php echo $this->getChildHtml('shipment_items') ?>
<?php echo $this->getChildHtml('shipment_packed') ?>
</div><!--28-11-2013-->
<!--<div class="box-left entry-edit">
    <div class="entry-edit-head"><h4><?php //echo $this->__('Shipment History') ?></h4></div>
    <fieldset><?php //echo $this->getChildHtml('order_comments') ?></fieldset>
</div>
-->


<?php /************************************** Showing the shipping docket information *********************************************/?>
<div class="entry-edit">
<div class="entry-edit-head"><h4><?php echo $this->__('Shipping Docket Vendor information') ?></h4></div>
<div class="grid np">
  <div class="hor-scroll">
	
	<table class="data-table" id="design_tab" cellspacing="0">
		<thead>
	  <tr class="headings">
		<th> Item </th>
		<th>Supplier Invoice</th>
		<th>Con Note Number</th>
		<th>Carton</th>
		<th>Barcode</th>
		<th>Status</th>
	    </tr>
		</thead>



<?php
$temptableDocket=Mage::getSingleton('core/resource')->getTableName('vendor_docket');
$temptableItem=Mage::getSingleton('core/resource')->getTableName('vendor_item');

$sqlItem="SELECT * FROM  ".$temptableItem." WHERE order_id = '".$_order->getId()."' ";
$chkItem = Mage::getSingleton('core/resource')->getConnection('core_write')->fetchAll($sqlItem);



foreach($chkItem as $item)
{
  $sqlDocket="SELECT * FROM  ".$temptableDocket." WHERE vendor_list_id = '".$item['entity_id']."' ";
  $chkDocket = Mage::getSingleton('core/resource')->getConnection('core_write')->fetchAll($sqlDocket);
  
  $product=Mage::getModel('catalog/product')->load($item['product_id']);
  
  $urlcode = Mage::helper('adminhtml')->getUrl('BarcodeLabel/Admin/LabelPreviewOrder/order_id/'.$_order->getId().'/product_id/'.$item['product_id']);
  ?>
	  <tr >
		<th> <?php echo $product->getName().' - (Sku :'.$product->getSku().')';?> </th>
		<th><?php echo $chkDocket[0]['supplier_invoice'];?></th>
		<th><?php echo $chkDocket[0]['connote_number'];?></th>
		<th><?php echo $chkDocket[0]['carton'];?></th>
		<!--<th><img src="<?php //echo $urlcode ;?>" border="1"/></th>
		-->
		<th><img src="<?php echo $urlcode ;?>" style="width:100px; height:30px; cursor:pointer;" border="1" onclick="urlMaker('<?php echo Mage::helper('adminhtml')->getUrl('BarcodeLabel/Admin/PrintProductLabelsOrder/order_id/'.$_order->getId().'/product_id/'.$item['product_id'].'/count/1/') ?>');"/></th>
		<th><?php echo $chkDocket[0]['status']; if($chkDocket[0]['status'] == 'sent'){?><br/><spen style="cursor:pointer;" onclick="loadimage(<?php echo $item['entity_id']?>)">Show Image</spen><?php }?></th>
	    </tr>
  <?php
}

?>
	</table>
    
  </div>
</div>
</div>

<div id="allsentimage" style="display:none;">
	<div class="chatclose" onclick="uploadclose();">X</div>
	<div id="sentimage"></div>
</div>
<style>
#allsentimage{
	display: block;
position: fixed;
width: 266px;
min-height: 104px;
left: 569px;
top: 100px;
background-color: #FFFFFF;
    border: 1px solid #E8E8E8;
    box-shadow: 0 0 10px #000000;
}
#sentimage{
margin-top: 12px;
}
</style>

<script type="text/javascript">
function uploadclose()
   {
     document.getElementById('allsentimage').style.display = 'none';
   }
function loadimage(listid)
{
	var xmlhttp;
       if (window.XMLHttpRequest)
	 {// code for IE7+, Firefox, Chrome, Opera, Safari
	 xmlhttp=new XMLHttpRequest();
	 }
       else
	 {// code for IE6, IE5
	 xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
	 }
       xmlhttp.onreadystatechange=function()
	 {
	 if (xmlhttp.readyState==4 && xmlhttp.status==200)
	   {
		//alert(xmlhttp.responseText);
		document.getElementById("sentimage").innerHTML=xmlhttp.responseText;
		document.getElementById('allsentimage').style.display = 'block';
	       
	       
	   }
	 }
       form_key = '<?php echo Mage::getSingleton('core/session')->getFormKey() ?>';
       xmlhttp.open("POST","<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB); ?>index.php/vendor/adminhtml_vendor/loadsentupload/?listid="+listid+"&form_key="+form_key+"&isAjax=true",true);
       xmlhttp.send();
}


function zoom(image)
{
	document.getElementById('zoom_image').src=image;
	document.getElementById('zoomimage').style.display = 'block';
	document.getElementById('layout1').style.display = 'block';
}

function zoom_close()
{
	document.getElementById('zoomimage').style.display = 'none';
	document.getElementById('layout1').style.display = 'none';
}

</script>

<br/>
<?php /************************************** Showing the shipping docket information *********************************************/?>


<!-------------------------15-11-2013 SOC Ware house instruction starts here------------------------------------>

<?php $urlwr = Mage::helper("adminhtml")->getUrl("vendor/adminhtml_vendor/setoptionshipment"); ?>
<div class="zoomimage" id="zoomimage" style="display:none;">
	<div class="close_zoom" onclick="zoom_close();">X</div>
	<div ><img id="zoom_image" style="width:800px; height:450px"/></div>
</div>
<div class="layout1" id="layout1" style="display:none;"></div>
<style>
.zoomimage{
	position: fixed;
background-color: white;
z-index: 9999;
top: 60px;
left: 279px;
box-shadow: 0 0 10px #000000;
}

.close_zoom{
	float: right;
margin-right: 10px;
font-size: 25px;
font-weight: bold;
margin-top: 15px;
cursor:pointer;
}
.layout1{
	background-color: black;
width: 100%;
height: 100%;
position: fixed;
top: 0px;
left: 0px;
z-index: 999;
opacity: 0.5;
}

</style>

<div class="entry-edit">
<form name="" action="<?php echo $urlwr; ?>" method="post" enctype="multipart/form-data" >
<div class="entry-edit-head"><h4><?php echo $this->__('Warehouse Instructions') ?></h4>
<?php /*if($roleName == 'Administrators'){ ///18-11-2013 SOC ?>
	 
            <span class="submitclass" style="float: right;" >
               <input name="submit" id="submit" type="submit"  class="submit-img" style="float: left;" value="Submit" />
           </span>
	<?php }*/ ?></div>
<div class="grid np">
  <div class="hor-scroll">
    
    <table cellspacing="0" class="data order-tables">
        <!--<col />
        <col width="1" />-->
        <thead>
            <tr class="headings">
                <th><?php echo $this->helper('sales')->__('Product') ?></th>
                <th><span class="nobr"><?php echo $this->helper('sales')->__('Instructions') ?></span></th>
            </tr>
        </thead>
        <?php $_items = $_order->getAllItems() ?>
        
        <tbody>
         <tr><td colspan="2">
         
         <input type="hidden" name="form_key" value="<?php echo Mage::getSingleton('core/session')->getFormKey(); ?>" />
         <input type="hidden" name="shipmentId" value="<?php echo $partShipID;?>" />
         
	 
	
         </td></tr>   
        <?php $_i=0;foreach ($_items as $_item):  $_i++; ?>
            
                <tr class="<?php echo $_i%2?'odd':'even' ?>">
		<?php
                
                $connectionRead = Mage::getSingleton('core/resource')->getConnection('core_read');
                $temptableOption=Mage::getSingleton('core/resource')->getTableName('vendor_option');
                $proId=$_item->getProductId();
                $select = $connectionRead->select()
			      ->from($temptableOption, array('*'))
			      ->where('type=?',2)
			      ->where('product_id=?',$proId);
			      
		$result = $connectionRead->fetchAll($select);
                $url2 = Mage::helper('adminhtml')->getUrl('vendor/adminhtml_vendor/downloadcustom');
                $i = 1;
		$l=1;
                ?>
                <td style="width:20%;">
			<table cellpadding="0" cellspacing="0"  ><tr><td style="width:90%;border:0px;"><span style="float:left;"><?php echo $_item->getName().' - (Sku :'.$_item->getSku().')'; ?></span></td>
			<td style="width:10%;border:0px;"><?php /*if($roleName == 'Administrators'){ ///18-11-2013 SOC ?>
                    <span onclick="add_another3(<?php echo $proId;?>);" style="cursor:pointer;float: left;" title="Add book suggetion" class="addanother">Add </span>
                 <?php }*/ ?>  </td> </tr></table></td>
                
                
                <input type="hidden" name="product_id[]" value="<?php echo $proId;?>"/>
                <input type="hidden" name="type" value="2"/>
                
                <td>
                    <table class="tabclass" id="tblid_<?php echo $proId;?>">
                    <tr>
                    <td>
		
                
                
                <?php
                    foreach($result as $option){
                    if($option['parent_id'] == 0){ ?>
                     <table id="tab1_<?php echo $i?>" class="tabclass" style="width: 100%;" cellpadding="0" cellspacing="0">
				    <tr>
				       <td>
					  <table style="width: 100%;">
					     <tr>
						<!--<td>Title</td>-->
						<td>
						   <span><?php /* ?><input style="float: left;" class="caption"  type="text" name="title[<?php echo $proId;?>][<?php echo $i?>]" value="<?php echo $option['title'];?>" <?php if($roleName !== 'Administrators'){ ///18-11-2013 SOC ?> readonly="readonly" <?php }  ?>/><?php */ echo $option['title'];?></span>
						
							<?php /*if($roleName == 'Administrators'){ ///18-11-2013 SOC ?>
						      <span style="float: left;" onclick="add_row2('<?php echo $i ?>','<?php echo $proId ?>');" style="cursor:pointer;float: right;" class="addanother">Add New</span>
						      <?php } ?>
						  
						<?php if($roleName == 'Administrators'){ ///18-11-2013 SOC ?>
						  <span style="float: left;" class="removeitem" onclick="div_remove3('<?php echo $i?>','<?php echo $proId;?>')" id="rem_<?php echo $i?>" style="cursor:pointer;">Remove</span>
						<?php }*/ ?>
					       </td>
					     </tr>
					  </table>
				       </td>
				       
				    </tr>
				    <tr>
				       <td class="grid">
					  <table style="width: 100%;" class="border" cellpadding="0" cellspacing="0">
					     <thead>
						<tr class="headings">
						   <td class="tabtitle">Title</td>
						   <td class="tabtitle">Value</td>
						   <td class="tabfile">File</td>
						   
						</tr>
					     </thead>
					     <tbody id="row1_<?php echo $i."_".$proId ?>">
					     <?php
					     
						foreach($result as $value)
						{
                                                    
						   if($value['parent_id'] == $option['entity_id'])
						   {
						?>
						<tr id="ind1_<?php echo $l."_".$proId;?>">
                                                
                                                
                                                <td style="width:40%;"><?php /* ?><input type="text" name="customtitle[<?php echo $proId;?>][<?php echo $i?>][]" value="<?php echo $value['sub_title']?>" <?php if($roleName !== 'Administrators'){ ///18-11-2013 SOC ?> readonly="readonly" <?php } ?>/><?php */ echo $value['sub_title']?></td>
                                                <td style="width:40%;"><?php /*?><input type="text" name="customvalue[<?php echo $proId;?>][<?php echo $i?>][]" value="<?php echo $value['sub_value']?>" <?php if($roleName !== 'Administrators'){ ///18-11-2013 SOC ?> readonly="readonly" <?php } ?>/><?php */ echo $value['sub_value']?></td>
                                                <?php /*?>
						<td >
						<?php if($roleName == 'Administrators'){ ///18-11-2013 SOC ?>
                                                    <span><input type="file" name="customfile[<?php echo $proId;?>][<?php echo $i?>][]" /></span>
						<?php }
						?>
						</td>
						<?php */?>
						<td style="width:20%;" ><?php
						$ext = end(explode('.',$value['file']));
						$supported_image = array('gif','jpg','jpeg','png');
						if(in_array($ext,$supported_image))
						{
							$file = Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_MEDIA).'custom_product/'.$value['file'];
							
							echo '<span><img onclick="zoom(\''.$file.'\');" style="width:27px; height:24px; " src="'.$file.'"/></span>';
							
						}
						else if($ext == 'pdf')
						{
							echo '<span><a href="'.$url2.'file/'.$value['file'].'"><img style="width:27px; height:24px; " src="'.Mage::getDesign()->getSkinUrl().'images/pdf_icon.jpg"/></a></span>';
						}
						else if($ext == 'doc' or $ext == 'docx')
						{
							echo '<span><a href="'.$url2.'file/'.$value['file'].'"><img style="width:27px; height:24px; " src="'.Mage::getDesign()->getSkinUrl().'images/doc_icon.jpg"/></a></span>';
						}
						
						?>
                                                   <!-- <a href="<?php //echo $url2.'file/'.$value['file'].'/';?>"><?php //echo $value['file']?></a>-->
                                                    <input type="hidden" name="existfile[<?php echo $proId;?>][<?php echo $i?>][]" value="<?php echo $value['file']?>"/>
                                                </td>
						
						<?php /*?>
                                                <td>
							<?php if($roleName == 'Administrators'){ ///18-11-2013 SOC ?>
							<span class="removeitem" onclick="row_remove4('<?php echo $l ?>','<?php echo $proId ?>')" id="rem_<?php echo $l;?>'" style="cursor:pointer;">Remove</span>
							<?php } ?>
						
						</td>
						<?php */?></tr>
						   <?php
						   }
						   $l++;
						}
					     ?>
					     </tbody >
					  </table>
				       </td>
				    </tr>
				 </table>
			
			<?php
				    $i++;	 
				
                    
                   }
                }
		
                
                ?>
                </td>
                    </tr>
                    <tr>
                        <td height="10" align="left" valign="middle" colspan="6" id="content<?php echo $proId;?>">
                        
			</td>
                    </tr>
                   <input type="hidden" id="form_count1" value="<?php echo $i?>" />
                   <input type="hidden" id="row_count1" value="<?php echo $l?>"  />
                </table>
                
                
                
                </td></tr>
                
            
        <?php endforeach; ?>
       
        </tbody>
    </table>
     </form>
  </div>
</div>
</div>



<div class="clear"></div>

<!-------------------------15-11-2013 EOC Ware house instruction ends here------------------------------------>
<div class="box-left entry-edit">
    <div class="entry-edit-head"><h4><?php echo $this->__('Shipment History') ?></h4></div>
    <fieldset><?php echo $this->getChildHtml('order_comments') ?></fieldset>
</div>

<!--15-11-2013 SOC-->

<link rel="stylesheet" type="text/css" href="<?php echo $this->getSkinUrl()?>vendor.css" />

<script type="text/javascript">

  
function add_another3(id)
{
	i = document.getElementById('form_count1').value;
	//alert(id);
	i++;
	
	var str = '<table id="tab1_'+i+'" class="tabclass" style="width: 100%;" cellpadding="0" cellspacing="0"><tr><td><table style="width: 100%;" cellpadding="0" cellspacing="0"><tr><td>Title</td><td><span style="float:left;"><input class="caption" type="text" name="title['+id+']['+i+']"/></span><span style="float: left;" onclick="add_row2('+i+','+id+');" style="cursor:pointer;float: right;" class="addanother">Add New</span><span style="float: left;" class="removeitem" onclick="div_remove3('+i+','+id+')" id="rem_'+i+'" style="cursor:pointer;">Remove</span></td></tr></table></td>      </tr><tr><td class="grid"><table style="width: 100%;" class="border" cellpadding="0" cellspacing="0"><thead><tr class="headings"><td class="tabtitle">Title</td><td class="tabtitle">Value</td><td class="tabfile">File</td></tr></thead><tbody id="row1_'+i+'_'+id+'"></tbody ></table></td></tr></table>';
	
        
        
	jQuery("#content"+id).append(str);
        //jQuery("#content"+id).bind(str);
	document.getElementById('form_count1').value = i;
	
}

function div_remove3(id,pId)
{
	i = document.getElementById('form_count1').value;
	jQuery("#tab1_"+id).remove();
        
}

function add_row2(id,pId)
{
      l = document.getElementById('row_count1').value;
	//alert(pId);
	//alert(id);
	
      l++;
	
      var str = '<tr id="ind1_'+l+'_'+pId+'"><td><input type="text" name="customtitle['+pId+']['+id+'][]"/></td><td><input type="text" name="customvalue['+pId+']['+id+'][]"/></td><td><input type="file" name="customfile['+pId+']['+id+'][]"/></td><td></td><td><span class="removeitem" onclick="row_remove4('+l+','+pId+')" id="rem_'+l+'" style="cursor:pointer;">Remove</span></td></tr>';
	
      jQuery("#row1_"+id+"_"+pId).append(str);
      document.getElementById('row_count1').value = l;
}

function row_remove4(id,pId)
{
        
        //alert(id+'-'+pId);
	jQuery("#ind1_"+id+"_"+pId).remove();
}
</script>
<!--15-11-2013 EOC-->

