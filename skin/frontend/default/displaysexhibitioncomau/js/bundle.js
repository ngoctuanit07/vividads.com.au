if(typeof Product=="undefined"){var Product={}}Product.Bundle=Class.create();Product.Bundle.prototype={initialize:function(e){this.config=e;if(e.defaultValues){for(var t in e.defaultValues){if(this.config["options"][t].isMulti){var n=new Array;for(var r=0;r<e.defaultValues[t].length;r++){n.push(e.defaultValues[t][r])}this.config.selected[t]=n}else{this.config.selected[t]=new Array(e.defaultValues[t]+"")}}}this.reloadPrice()},changeSelection:function(e){var t=e.id.split("-");if(this.config["options"][t[2]].isMulti){selected=new Array;if(e.tagName=="SELECT"){for(var n=0;n<e.options.length;n++){if(e.options[n].selected&&e.options[n].value!=""){selected.push(e.options[n].value)}}}else if(e.tagName=="INPUT"){selector=t[0]+"-"+t[1]+"-"+t[2];selections=$$("."+selector);for(var n=0;n<selections.length;n++){if(selections[n].checked&&selections[n].value!=""){selected.push(selections[n].value)}}}this.config.selected[t[2]]=selected}else{if(e.value!=""){this.config.selected[t[2]]=new Array(e.value)}else{this.config.selected[t[2]]=new Array}this.populateQty(t[2],e.value)}this.reloadPrice()},reloadPrice:function(){var e=0;var t=0;var n=0;for(var r in this.config.selected){if(this.config.options[r]){for(var i=0;i<this.config.selected[r].length;i++){var s=this.selectionPrice(r,this.config.selected[r][i]);e+=Number(s[0]);t+=Number(s[1]);n+=Number(s[2])}}}var o=$(document).fire("bundle:reload-price",{price:e,priceInclTax:n,dispositionPrice:t,bundle:this});if(!o.noReloadPrice){optionsPrice.specialTaxPrice="true";optionsPrice.changePrice("bundle",e);optionsPrice.changePrice("nontaxable",t);optionsPrice.changePrice("priceInclTax",n);optionsPrice.reload()}return e},selectionPrice:function(e,t){if(t==""||t=="none"){return 0}var n=null;if(this.config.options[e].selections[t].customQty==1&&!this.config["options"][e].isMulti){if($("bundle-option-"+e+"-qty-input")){n=$("bundle-option-"+e+"-qty-input").value}else{n=1}}else{n=this.config.options[e].selections[t].qty}if(this.config.priceType=="0"){price=this.config.options[e].selections[t].price;tierPrice=this.config.options[e].selections[t].tierPrice;for(var r=0;r<tierPrice.length;r++){if(Number(tierPrice[r].price_qty)<=n&&Number(tierPrice[r].price)<=price){price=tierPrice[r].price}}}else{selection=this.config.options[e].selections[t];if(selection.priceType=="0"){price=selection.priceValue}else{price=this.config.basePrice*selection.priceValue/100}}var i=this.config.options[e].selections[t].plusDisposition+this.config.options[e].selections[t].minusDisposition;if(this.config.specialPrice){newPrice=price*this.config.specialPrice/100;newPrice=(Math.round(newPrice*100)/100).toString();price=Math.min(newPrice,price)}selection=this.config.options[e].selections[t];if(selection.priceInclTax!==undefined){priceInclTax=selection.priceInclTax;price=selection.priceExclTax!==undefined?selection.priceExclTax:selection.price}else{priceInclTax=price}var s=new Array(price*n,i*n,priceInclTax*n);return s},populateQty:function(e,t){if(t==""||t=="none"){this.showQtyInput(e,"0",false);return}if(this.config.options[e].selections[t].customQty==1){this.showQtyInput(e,this.config.options[e].selections[t].qty,true)}else{this.showQtyInput(e,this.config.options[e].selections[t].qty,false)}},showQtyInput:function(e,t,n){elem=$("bundle-option-"+e+"-qty-input");elem.value=t;elem.disabled=!n;if(n){elem.removeClassName("qty-disabled")}else{elem.addClassName("qty-disabled")}},changeOptionQty:function(e,t){var n=true;if(typeof t!="undefined"){if(t.keyCode==8||t.keyCode==46){n=false}}if(n&&(Number(e.value)==0||isNaN(Number(e.value)))){e.value=1}parts=e.id.split("-");optionId=parts[2];if(!this.config["options"][optionId].isMulti){selectionId=this.config.selected[optionId][0];this.config.options[optionId].selections[selectionId].qty=e.value*1;this.reloadPrice()}},validationCallback:function(e,t){if(e==undefined||$(e)==undefined){return}var n=$(e).up("ul.options-list");if(typeof n!="undefined"){if(t=="failed"){n.removeClassName("validation-passed");n.addClassName("validation-failed")}else{n.removeClassName("validation-failed");n.addClassName("validation-passed")}}}}