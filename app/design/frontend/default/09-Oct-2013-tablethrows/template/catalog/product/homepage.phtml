<?php
$_helper = $this->helper('catalog/output');
$_category = Mage::getModel('catalog/category')->load(48);
$_categories = $_category->getCollection()
                         ->addAttributeToSelect(array('name', 'url', 'description'))
                         ->addIdFilter($_category->getChildren());

foreach ($_categories as $_category):
?>
<div class="stretch-table">
    <div class="view-more"><p align="right"><a title="<?php echo $_category->getName()?>" href="<?php echo $_category->getUrl()?>">View All</a>&nbsp;</p></div>
    <h1><?php echo $_category->getName()?></h1>
    <p>
        <div class="category-products">
            <ul class="products-grid">
                <?php
                $_productCollection = getProductsByCategory($_category->getId());
                $_collectionSize = $_productCollection->count();
                $_columnCount = $this->getColumnCount();
                $_columnCount = 4; 
                $_collectionSize = 4;
                $i=0;
                        
                foreach($_productCollection as $_product):
                    $i++;
                ?>
                    <li style="width:273px;" class="item<?php if (($i - 1) % $_columnCount == 0): ?> first<?php elseif ($i % $_columnCount == 0): ?> last<?php endif; ?>">
                        <div class="product-box">
                            <div id="quickView_btn" class="deactive" style="display: none;"></div>
                            <a id="pb_item_<?php echo $_product->getId() ?>" href="<?php echo $_product->getProductUrl() ?>" title="<?php echo $this->stripTags($this->getImageLabel($_product, 'small_image'), null, true) ?>" class="product-image"><img src="<?php echo $this->helper('catalog/image')->init($_product, 'small_image')->resize(250); ?>" width="250" alt="<?php echo $this->stripTags($this->getImageLabel($_product, 'small_image'), null, true) ?>" /></a>
                            <?php
                            $route = Mage::app()->getRequest()->getRouteName();
                            $id = Mage::getSingleton('cms/page')->getIdentifier();
                            if ($route == 'cms' && $id == 'home') {
                                ?>  
                                <?php $symbol = Mage::app()->getLocale()->currency(Mage::app()->getStore()->getCurrentCurrencyCode())->getSymbol(); ?>
                                <div>
                                    <h2 class="product-name"><a href="<?php echo $_product->getProductUrl() ?>" title="<?php echo $this->stripTags($_product->getName(), null, true) ?>"><?php echo $_helper->productAttribute($_product, $_product->getName(), 'name') ?></a></h2>
                                    
                                    <?php $specialPrice = number_format($_product->getFinalPrice(), 2); ?>
                                    <span class="price" style="font-size:14px; font-weight:bold; margin-left:20px;"><?php echo "SALE: " . $symbol . $specialPrice ?></span>                                    
                                    <br />
                                    <span class="price" style="font-size:12px; font-weight:bold;text-decoration:line-through; color:#ff6c00;">
                                        <?php echo $price = $symbol . number_format($_product->getPrice(), 2);?> 
                                    </span>
                        <?php } ?> 
                        <?php
                         $rating_collection = Mage::getModel('rating/rating')->getEntitySummary($_product->getData('entity_id'),true);
                        $rating_count = $rating_collection->getData('count');
                        if (!empty($rating_count)) {
                            $rating_sum = $rating_collection->getData('sum') / $rating_count;
                            ?>
                            <div class="star-rating-box">
                                <div class="review-section">    
                                    <div class="ratings">
                                        <div class="rating-box">
                                            <div style="width:<?php echo $rating_sum;?>%" class="rating"></div>
                                        </div>
                                        <div style="clear:both"></div>
                                        <div class="rating-links">
                                            <a href="http://localhost/tablethr/review/product/list/id/391/">Read 1 Review(s)</a>                                            
                                        </div>
                                    </div>
                                </div>
                            </div>        
                            <?php        
                        } 
                        else{
                            echo "<div class='ratings'><div class='rating-links'><a href='".$_product->getProductUrl()."'>" . $this->__('Be the first to review this product') . "</a></div></div>";
                        }
                        ?>
                                <div class="clear"></div>
                            </div>
                    </li>
                <?php
                if($i==3)break;
                endforeach;
                ?>
            </ul>
        </div>        
    </p>
</div>
<div class="clear">&nbsp;</div>
<?php
endforeach;
function getProductsByCategory($category_id) {
    $products = Mage::getModel('catalog/category')->load($category_id); //put your category id here
    return $productslist = $products->getProductCollection()->addAttributeToSelect('*');
}       
?>
