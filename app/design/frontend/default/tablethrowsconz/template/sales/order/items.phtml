<?php/** * Magento * * NOTICE OF LICENSE * * This source file is subject to the Academic Free License (AFL 3.0) * that is bundled with this package in the file LICENSE_AFL.txt. * It is also available through the world-wide-web at this URL: * http://opensource.org/licenses/afl-3.0.php * If you did not receive a copy of the license and are unable to * obtain it through the world-wide-web, please send an email * to license@magentocommerce.com so we can send you a copy immediately. * * DISCLAIMER * * Do not edit or add to this file if you wish to upgrade Magento to newer * versions in the future. If you wish to customize Magento for your * needs please refer to http://www.magentocommerce.com for more information. * * @category    design * @package     base_default * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com) * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0) */?><?php  $_order = $this->getOrder();  $session_messages =Mage::getSingleton('core/session')->getMessages(); // var_dump($session_messages); ?><table class="data-table" id="my-orders-table" summary="<?php echo $this->__('Items Ordered') ?>">    <col />    <col width="1" />    <col width="1" />    <col width="1" />    <col width="1" />    <thead>        <tr align="center" style="height:30px; vertical-align:middle;">            <th align="left"><?php echo $this->__('Item') ?></th>            <th  ><?php echo $this->__('Product Name') ?></th>            <th style="text-align:center;"><?php echo $this->__('SKU') ?></th>            <th style="text-align:center;"><?php echo $this->__('Price') ?></th>            <th style="text-align:center;"><?php echo $this->__('Qty') ?></th>            <th style="text-align:center;"><?php echo $this->__('Subtotal') ?></th>        </tr>    </thead>    <tfoot>        <?php echo $this->getChildHtml('order_totals') ?>    </tfoot>        <?php $_items = $_order->getItemsCollection(); ?>        <?php $_index = 0; ?>            <?php $_count = $_items->count(); ?>        <?php foreach ($_items as $_item): ?>        <?php if ($_item->getParentItem()) continue; ?>        <tbody >             <tr><td style=" background-color:white !important; border-bottom:1px solid #d9dbd9;" colspan="6"></td></tr>            <?php echo $this->getItemHtml($_item) ?>            <?php if($this->helper('giftmessage/message')->getIsMessagesAvailable('order_item', $_item) && $_item->getGiftMessageId()): ?>            <tr class="border<?php echo ($_index++ > $_count ?' last':'') ?>" id="order-item-gift-message-<?php echo $_item->getId() ?>" style="display:none;">                <?php $_giftMessage=$this->helper('giftmessage/message')->getGiftMessageForEntity($_item); ?>                <td class="gift-message-row" colspan="7">                    <a href="#" title="<?php echo $this->__('Close') ?>" onClick="return giftMessageToogle('<?php echo $_item->getId() ?>');" class="btn-close"><?php echo $this->__('Close') ?></a>                    <dl class="gift-message">                        <dt><strong><?php echo $this->__('From:') ?></strong> <?php echo $this->htmlEscape($_giftMessage->getRecipient()) ?></dt>                        <dt><strong><?php echo $this->__('To:') ?></strong> <?php echo $this->htmlEscape($_giftMessage->getSender()) ?></dt>                        <dd><?php echo $this->helper('giftmessage/message')->getEscapedGiftMessage($_item) ?></dd>                    </dl>                </td>            </tr>                        <?php endif ?>        </tbody>        <?php endforeach; ?></table><script type="text/javascript"><!--decorateTable('my-orders-table', {'tbody' : ['odd', 'even'], 'tbody tr' : ['first', 'last']});--></script><div style="clear:both;"></div><!--<button class="button" onclick="div_show();" type="button"><span><span>Pay Now</span></span></button>-->	<?php 			/* if order is non-paid */			if( $_order->getTotalDue() != 0 ){			?>	<!-- payment information start -->		<div class="order-totals">		<style>	.total_payment{	/* position: fixed;	top: 8%;	left: 30%;	background-color: white;	*/	border-radius: 0.75em;	height: 14em !important;	width: 23em !important;	}	.close_div{	 /*	  position: fixed;	top: 24%;	left: 66%;	background-color: white;	width: 21px;	height: 30px;	*/		}		.offline_payment{ 		float: right;		width: 282px;		background-color: #e8e8e8;		}		.block_div{	 text-align: left;	margin-top: 16px;	}			.calendar{	position: fixed !important;  left: 668px !important; top: 168px !important;	}	.cCardTable{ margin-left: 13px; }		select{		-moz-appearance: none;    background: none repeat scroll 0 0 transparent !important;    border: 1px solid #acacac !important;    border-radius: 3px;    color: #7c7c7c !important;    cursor: pointer;    display: inline-block;    font-size: 16px !important;    font-weight: bold !important;    height: 36px !important;    line-height: 26px;    margin: 0;    outline: medium none;    padding: 5px;    width: 248px;		}		.total_payment{border:0px solid #ccc; width: 361px !important;height: auto !important;padding: 20px;left: 50% !important;margin-left: 10px;}	.total_payment .offline_payment table{width:100%;}	.total_payment .offline_payment table td{text-align:left;padding: 2px 5px;}	.total_payment .offline_payment table td.lebelall{text-align:right;}	.total_payment .offline_payment table td input[type="text"]{width:100px;}	.close_div{left: 310px !important;position: absolute !important;top: 7px !important;cursor: pointer;}	.openpay{float:right; color:#fff; text-decoration:underline; cursor:pointer;}		.order-tables thead th{font-weight:bold; padding:3px 20px 3px 10px;}	.order-tables thead th, .order-tables tbody td{text-align:left;}	.cvvcode{float:left;}	.ccno{ width:185px !important; float:left;}	#anz_egate_cc_number{width:185px;}	.ccname{width:142px; float:left;}	.ccexpdate{width:130px;}	.payNow{		background-color: #f60;		border: 1px solid #f60;		clear: both;		color: #fff;		float: left;		font-size: 14px;		font-weight: bold;		height: 30px;		width: 89px;		box-shadow: 2px 2px 2px #b8b8b8;		margin-top: 13px;		margin-bottom: 21px;		cursor: pointer;		}		#paymentloader{						border: 0px solid red;		float: right;		height: 39px;		position: relative;		right: 18px;		top: 20px;		width: 100px;		display:none;				}	#paymentInfo{		border: 0px solid red;		height: 30px;		width: 265px;		margin-left: 14px;		color: #ff0000;		font-size: 11px;		display:none;		}			</style>		<script src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_JS); ?>mage/adminhtml/sales.js" type="text/javascript"></script>		<script type="text/javascript">		var order = new AdminOrder();		order.setLoadBaseUrl('');		var payment = {};		payment.switchMethod = order.switchPaymentMethod.bind(order);	</script>	   	<!--<fieldset id="checkout-payment-method-load">			<?php echo $this->getChildHtml('methods') ?>		</fieldset>-->		<div>	<?php 			//Get Payment Info				$payment = $_order->getPayment();				$payment->getMethodInstance()->getCode();				$payment->getMethodInstance()->getTitle();					//Get Credit Card info				$payment->getMethodInstance()->getCardsStorage();			//	$payment->getMethodInstance()->getCardsStorage()->getCards(); //array()				//Zend_debug::dump($payment->getData());exit;	?>		</div>			 	   <div class="offline_payment">		<form enctype="multipart/form-data" method="get" action="<?php echo Mage::getUrl('partialpayment/adminhtml_partialpayment/paymentfront/')?>" id="edit_form" onSubmit="return all_save()">	 <input type="hidden" value="<?php echo $_order->getId();  ?>" id="orderid" name="orderid">	 <input type="hidden" value="<?php echo $_order->getId();  ?>" id="order_id" name="order_id">	 <input type="hidden" value="<?php echo $_order->getId();  ?>" id="form_key" name="form_key">			<table class="cCardTable">				  					 <tbody><tr><td colspan="50">					 <div class="entry-edit">		<!--<div class="entry-edit-head">			<div style="float: right;"></div>			<h4 class="fieldset-legend head-payment-method icon-head">Payment Via Credit Card</h4>		</div>-->		<div >		   	<div id="order-billing_method_form">				<dl class="payment-methods" >				<dt style="display:none;">													  <input type="radio" onClick="payment.switchMethod('anz_egate')" title="Credit Card (Master/Visa/Amex" name="payment[method]" value="anz_egate" id="p_method_anz_egate" checked="checked">																   <label for="p_method_anz_egate">Credit Card (Master/Visa/Amex</label>		   </dt>								  <dd>									  <ul style="" id="payment_form_anz_egate">		<li >			<div class="input-box" >			<input type="hidden" class="required-entry" value="<?php echo $_order->getTotalDue(); ?>" id="received_amount" name="amount"   />			<input type="hidden" class="required-entry" value="<?php echo $_order->getTotalDue(); ?>" id="received_amount" name="amount"   />			<input type="hidden" class="required-entry" id="date" value="<?php echo date('Y-m-d');?>" name="date" disabled="true"; />				  <label for="anz_egate_cc_type">Credit Card Type <span class="required">*</span></label><br>	  <select class="required-entry validate-cc-type-select" name="payment[cc_type]" id="anz_egate_cc_type">		  <option value=""></option>		   <option value="AE">American Express</option>		   <option value="VI">Visa</option>			<option value="MC">MasterCard</option>	   </select>			</div>		</li>		<li>			<div class="input-box ccno">				<label for="anz_egate_cc_number">Credit Card Number <span class="required">*</span></label><br>				<input type="text" value="" class="input-text validate-cc-number" title="Credit Card Number" name="payment[cc_number]" id="anz_egate_cc_number" style="color: #7c7c7c !important; 		display: inline-block; font-size: 16px !important; font-weight: bold; height: 36px !important; line-height: 26px;background: none repeat scroll 0 0 transparent !important;">			</div>						<div class="input-box cvvcode">				<label for="anz_egate_cc_cid">Security Code <span class="required">*</span></label><br>				<input type="text" value="" style="width:4em;color: #7c7c7c !important; 		display: inline-block; font-size: 16px !important; font-weight: bold; height: 36px !important; line-height: 26px;background: none repeat scroll 0 0 transparent !important; " name="payment[cc_cid]" id="anz_egate_cc_cid" class="required-entry input-text validate-cc-cvn" title="Card Verification Number">			</div>								</li>		<li>		<div class="input-box ccname">				<label for="anz_egate_cc_name">Name on Card <span class="required">*</span></label><br>				<input type="text" value="" class="input-text validate-cc-name" title="Credit Card Number" name="payment[cc_name]" id="anz_egate_cc_name" style="color: #7c7c7c !important; 		display: inline-block; font-size: 16px !important; font-weight: bold; height: 36px !important; line-height: 26px; width:140px; background: none repeat scroll 0 0 transparent !important;">			</div>			<div class="input-box" class="ccexpdate">				<label for="anz_egate_expiration">Expiration Date <span class="required">*</span></label><br>				<select class="validate-cc-exp required-entry" name="payment[cc_exp_month]" style="width:58px;" id="anz_egate_expiration">							  <option selected="selected" value="0">MM</option>								<option value="1">01</option>								<option value="2">02</option>								<option value="3">03</option>								<option value="4">04</option>								<option value="5">05</option>								<option value="6">06</option>								<option value="7">07</option>								<option value="8">08</option>								<option value="9">09</option>								<option value="10">10</option>								<option value="11">11</option>								<option value="12">12</option>							</select>							<select class="required-entry" name="payment[cc_exp_year]" style="width:58px;" id="anz_egate_expiration_yr">								<option selected="selected" value="">YY</option>								<option value="2014">14</option>								<option value="2015">15</option>								<option value="2016">16</option>								<option value="2017">17</option>								<option value="2018">18</option>								<option value="2019">19</option>								<option value="2020">20</option>								<option value="2021">21</option>								<option value="2022">22</option>								<option value="2023">23</option>								<option value="2024">24</option>							</select>			</div>		</li>							</ul>								  </dd>					  				  </dl>	</div>	<script type="text/javascript">order.setPaymentMethod('')</script>		<script type="text/javascript">		//&lt;![CDATA[	 Calendar.setup({			inputField : 'date',			ifFormat : '%Y-%m-%d',			button : '_dob_trig',		   // align : 'Bl',			singleClick : true		});	 //start 07_03_2014	 if(document.getElementById('delivery_date'))	 {	  Calendar.setup({			inputField : 'delivery_date',			ifFormat : '%m/%d/%Y',			button : 'delivery_date',		   // align : 'Bl',			singleClick : true		});	 }	 //End 07_03_2014	//]]&gt;	</script>		</div>	</div>	</td>		</tr>	  <tr>	 <td style="text-align:center;" colspan="50">					 <button id="submit" name="submit" type="submit" class="payNow" title="<?php echo __('Click to Pay for your order');?>">Pay Now</button>					 					 <div id="paymentloader" >					 <img src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_MEDIA).'loading.gif';?>" width=30px; />					 </div>					 					 </td>				   </tr>				</tbody></table>	</form>		<div id="paymentInfo"> 	<?php echo __('Please wait while your payment is being processed.');?>			</div>		   </div>		<script type="text/javascript">	//activate the payment type;	payment.switchMethod('anz_egate');		function div_show()	{	  document.getElementById('total_payment').style.display = 'block';	  //var id = jQuery('.payment-methods').find( "input:checked" ).attr('id');//11_03_2014	  jQuery('.payment-methods').find( "input:checked" ).trigger('click');//11_03_2014	}		function div_hide()	{	  document.getElementById('total_payment').style.display = 'none';	}		function isNumeric(value) {    var bool = isNaN(value);       return bool;	} 		/*validate card numbers*/	function validateCard(inputtxt,cardType)  		{  		  /* validating card numbers */		  		  var amec_cardno = /^(?:3[47][0-9]{13})$/;  		  var visa_cardno = /^(?:4[0-9]{12}(?:[0-9]{3})?)$/; 		  var master_cardno = /^(?:5[1-5][0-9]{14})$/; 		//  var discover_cardno = /^(?:6(?:011|5[0-9][0-9])[0-9]{12})$/; 		//  var jcb_cardno = /^(?:(?:2131|1800|35\d{3})\d{11})$/; 		  		/* American Express Validation */		if(!inputtxt.value.match(amec_cardno) && cardType.value=='AE')  			{  			 	alert("Not a valid Amercican Express credit card number!");  				return false; 			}  		/* VISA card Validation */		if(!inputtxt.value.match(visa_cardno) && cardType.value=='VI')  			{  			  				alert("Not a valid Visa credit card number!");  				return false; 			} 		/* Master card Validation */		if(!inputtxt.value.match(master_cardno) && cardType.value=='MC')  			{  			 				alert("Not a valid Master credit card number!");  				return false; 			} 							return true; 		}  				function all_save(){	   	  		var amount = document.getElementById('received_amount').value;		var order_id = document.getElementById('order_id').value;		var orderid = document.getElementById('orderid').value;		var date = document.getElementById('date').value;		var frm_key='<?php echo Mage::getSingleton('core/session')->getFormKey(); ?>';				var cc_type = document.getElementById('anz_egate_cc_type');		var cc_number = document.getElementById('anz_egate_cc_number');		var cc_cid = document.getElementById('anz_egate_cc_cid');		var cc_name = document.getElementById('anz_egate_cc_name');		var cc_expiration = document.getElementById('anz_egate_expiration');		var cc_expiration_yr = document.getElementById('anz_egate_expiration_yr');					var radio = document.getElementsByName('received_card');		   	  	var  payment_type = 'anz_card';	   				if(amount == '')		{		  alert("Please enter the received amount");		  return false;		}				if(date == '')		{		  alert("Please enter the date");		  return false;		}							if(payment_type == '')		{		  alert("Please select the payment type");		  return false;		}						//creadit card handling and authentication				if(cc_type.value=='')		{			alert('Please select a card type');						cc_type.focus();			cc_type.select();						return false;		}				if(cc_number.value=='')		{			alert('Please enter card number');						cc_number.focus();			cc_number.select();			return false;		}		   				if(isNumeric(cc_number.value)){							alert('Please enter valid card number');						cc_number.focus();			cc_number.select();			return false;		}				if(!isNumeric(cc_number.value)){							if(validateCard(cc_number, cc_type)){							}else{			cc_number.focus();						cc_number.select();						return false;			}		}								if(cc_cid.value=='')		{			alert('Please enter security code');									cc_cid.focus();			cc_cid.select();			return false;		}						if(isNumeric(cc_cid.value)){							alert('Please enter valid security code');			 			cc_cid.focus();			cc_cid.select();			return false;		}				if(cc_name.value=='')		{			alert('Please enter same name as on card');						cc_name.focus();			cc_name.select();			return false;		}						if(cc_expiration.value==0)		{			alert('Please select a expiration month');						cc_expiration.focus();			cc_expiration.select();			return false;		}				if(cc_expiration_yr.value=='')		{			alert('Please select expiration year');						cc_expiration_yr.focus();			cc_expiration_yr.select();			return false;		}		   			   		if (window.XMLHttpRequest)		{// code for IE7+, Firefox, Chrome, Opera, Safari			xmlhttp=new XMLHttpRequest();		}		else		{// code for IE6, IE5			xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");		}				///validating payment and  updating the order with credit card payment 				var formData={											received_amount:amount,						amount:amount,						order_id:order_id,						orderid:orderid,						payment_validated:1,						date:date,						form_key:frm_key,			};				var paymentValidated=0;				////validate paymetn first 				jQuery.ajax(		{				url : "<?php echo Mage::getUrl('AdvancedStock/index/SavepaymentFrontend')?>",				type: "GET",				data : formData,				beforeSend: function(beforeload)				{									},				success: function(data, textStatus, jqXHR)				{					//data - response from server					paymentValidated=1					console.log(data);					console.log('validated'+paymentValidated);								console.log(paymentValidated);		///enterting further paymnet				var frmData={						received_amount:amount,						amount:amount,						order_id:order_id,						orderid:orderid,						date:date,						form_key:frm_key,						anz_egate_cc_type:cc_type.value,						anz_egate_cc_number:cc_number.value,						anz_egate_cc_cid:cc_cid.value,						anz_egate_cc_name:cc_name.value,						anz_egate_expiration:cc_expiration.value,						anz_egate_expiration_yr:cc_expiration_yr.value,						payment_type:payment_type,		};						/*payment validation*/				if(paymentValidated==1){								jQuery.ajax(			{					url : "<?php echo Mage::getUrl('partialpayment/index/paymentfrontend')?>",					type: "GET",					data : frmData,					beforeSend: function(beforeload)					{						jQuery('#paymentloader').show();						jQuery('#paymentInfo').show();					},					success: function(data, textStatus, jqXHR)					{						//data - response from server						jQuery('#paymentloader').hide();										var paysuccess='<span style="color:green">Success your payment has been processed</span>';						jQuery('#paymentInfo').html(paysuccess);						jQuery('#paymentInfo').show();												url='<?php echo Mage::getUrl('sales/order/history/type/1/');?>';						 window.location = url;						//console.log(data);					},					error: function (jqXHR, textStatus, errorThrown)					{											}			});						} //end of payment validation				},				error: function (jqXHR, textStatus, errorThrown)				{			 		//console.log(errorThrown);				}		});		return false;						/*				xmlhttp.onreadystatechange=function()		{			if (xmlhttp.readyState==4 && xmlhttp.status==200)			{			//alert(xmlhttp.responseText);							//data= xmlhttp.responseText;			//document.getElementById('message_id').innerHTML = data;			//alert(data);										//if(xmlhttp.responseText == '')					location.reload();						   				// alert(xmlhttp.responseText);				// clock(); 			}		}		//alert(str);		xmlhttp.open("POST","http://localhost/tablethr_local/ajax/set_payment.php?amount="+amount+"&amp;payment_type="+payment_type+"&amp;date="+date+"&amp;order_id="+order_id,true);		xmlhttp.send(null);				*/	}			/**************End Ajax**************/	</script>		<?php 				} //end of total due	?>		</div>		<!-- end of payment information  -->